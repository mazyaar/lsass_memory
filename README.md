<section class="full_width small-text background-transparent padding-top-small padding-bottom-none" style=""><div class="container-fluid"><div class="row justify-content-lg-center"><div class="col-12"><div class="content-styled"><img decoding="async" loading="lazy" class="alignnone wp-image-25415 lazyloaded" style="margin-bottom: -40px;" src="https://redcanary.com/wp-content/uploads/2020/09/Icon_Alert-Center_Investigation.svg" alt="Analysis Icon" width="100" height="100" data-ll-status="loaded"><h2>Analysis</h2></div></div></div></div></section>
<section class="full_width small-text background-transparent padding-top-none padding-bottom-small" style=""><div class="container-fluid"><div class="row justify-content-lg-center"><div class="col-12"><div class="content-styled"><h3>Why do adversaries use LSASS Memory?</h3><p>Adversaries commonly abuse the <a href="https://attack.mitre.org/techniques/T1003/001/" target="_blank" rel="noopener noopener">Local Security Authority Subsystem Service</a> (LSASS) to dump credentials for privilege escalation, data theft, and lateral movement. The process is a fruitful target for adversaries because of the sheer amount of sensitive information it stores in memory. Upon starting up, LSASS contains valuable authentication data such as:</p><ul><li>encrypted passwords</li><li>NT hashes</li><li>LM hashes</li><li>Kerberos tickets</li></ul><p>The LSASS process is typically the first that adversaries target to obtain credentials. Post-exploitation frameworks like <a href="/threat-detection-report/threats/cobalt-strike/" target="_blank" rel="noopener noopener">Cobalt Strike</a> import and customize existing code from credential theft tools like <a href="/threat-detection-report/threats/mimikatz/" target="_blank" rel="noopener noopener">Mimikatz</a>, allowing operators to easily access LSASS via beacons.</p><h3>How do adversaries use LSASS Memory?</h3><p>Adversaries use a variety of tools and methods to dump or scan the process memory space of LSASS. Whatever method they choose, the ultimate goal is to obtain credentials, move laterally, and access valuable systems. In the abstract, LSASS abuse can be categorized broadly into two substantially overlapping categories:</p><ul><li>native processes</li><li>custom adversary tools</li></ul><p>The tooling that adversaries use to extract credentials from LSASS Memory exists on a spectrum ranging from legitimate to dual-purpose to overtly malicious. More often than not, adversaries drop and execute trusted administrative tools onto their target, so we’ll organize our analysis going from legitimate to ambiguous to malicious—starting with processes.</p><p>The Windows Task Manager (<code>taskmgr.exe</code>) and the Windows DLL Host (<code>rundll32.exe</code>) are the two built-in utilities that adversaries seem to abuse most often. Task Manager is capable of dumping arbitrary process memory if executed under a privileged user account. It’s as simple as right-clicking on the LSASS process and hitting “Create Dump File.” The Create Dump File calls the <code>MiniDumpWriteDump</code> function implemented in <code>dbghelp.dll</code> and <code>dbgcore.dll</code>. Additionally, <a href="/threat-detection-report/techniques/rundll32/" target="_blank" rel="noopener noopener">Rundll32</a> can execute the Windows native DLL <code>comsvcs.dll</code>, which exports a function called <code>MiniDump</code>. When this export function is called, adversaries can feed in a process ID such as LSASS and create a MiniDump file.</p><p>Adversaries frequently co-opt a number of Sysinternals tools to access the memory contents of LSASS. A few of the standouts include: <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump" target="_blank" rel="noopener noopener">Sysinternals Procdump</a>, <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/process-explorer" target="_blank" rel="noopener noopener">Sysinternals Process Explorer</a>, and Microsoft’s <a href="https://docs.microsoft.com/en-us/troubleshoot/sql/tools/use-sqldumper-generate-dump-file" target="_blank" rel="noopener noopener">SQLDumper.exe</a>.</p><p>&nbsp;</p><h3>Associated threats</h3><p>We aren’t always able to reliably differentiate when an offensive security tool is used by a red team or an adversary. In fact, as much as a quarter of our detections may be triggered by <a href="https://redcanary.com/threat-detection-report/trends/adversary-emulation-testing/" target="_blank" rel="noopener noopener">sanctioned tests</a>, so we detect the following irrespective of intent. That said, the LSASS-abusing tools we commonly see include:</p><ul><li><a href="https://redcanary.com/threat-detection-report/threats/mimikatz/" target="_blank" rel="noopener noopener">Mimikatz</a></li><li><a href="https://redcanary.com/threat-detection-report/threats/cobalt-strike/" target="_blank" rel="noopener noopener">Cobalt Strike</a></li><li><a href="https://redcanary.com/threat-detection-report/threats/impacket/" target="_blank" rel="noopener noopener">Impacket</a></li><li>Metasploit</li><li>PowerSploit</li><li>Empire</li><li>Pwdump</li><li>Dumpert</li></ul><p>Other threats that have abused LSASS Memory include <a href="https://redcanary.com/threat-detection-report/threats/trickbot/" target="_blank" rel="noopener noopener">TrickBot</a>, Zoremov, and <a href="/threat-detection-report/threats/rose-flamingo">Rose Flamingo</a>.</p></div></div></div></div></section>
